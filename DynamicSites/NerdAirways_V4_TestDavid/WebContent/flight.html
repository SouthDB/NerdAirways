<!DOCTYPE html>
<html lang="de-de">

<head>
    <link rel="shortcut icon" type="image/x-icon" href="resources/icon/favicon.ico" />
    <title>NerdAirways</title>
    <link rel="stylesheet" type="text/css" href="resources/css/style1.css">
    <link rel="stylesheet" type="text/css" href="resources/css/style2.css">
    <link rel="stylesheet" type="text/css" href="resources/css/style3.css">
    <link rel="stylesheet" type="text/css" href="resources/css/style4.css">
    <link rel="stylesheet" type="text/css" href="resources/css/style5.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8"> </head>

<body>
    <header>
        <h1 id="headline">NerdAirways</h1>
    </header>


    <ul class="navbar">
        <li class="navlink">
            <a href="home.html">Home</a>
        </li>
        <li class="navlink">
            <a class="active" href="flight.html">Flüge</a>
        </li>
        <li class="navlink">
            <a href="review.html">Rezensionen</a>
        </li>		
        <li class="navlink2"><input class="rightinput inputs" type="password" id="passwd" name="passwort" placeholder="Passwort..."></li>
        <li class="navlink2"><input class="rightinput inputs"type="text" id="user" name="benutzername" placeholder="Benutzername..."></li>
        <li class="navlink2"><input type="submit" value="Login"></li>
        <li class="navlink2"><a href="signup.html">Registrieren</a></li>
    </ul>


    <div class="central" id="center">
        <div class=flyoffer>
            <h2>Flug-Angebote</h2>
            <table class="table" id="flights">
                <tr class="table_head">
                    <th>Flugnummer</th>
                    <th>Von</th>
                    <th>Nach</th>
                    <!--<th>Datum</th>-->           <!--nicht in der Datenbank vorhanden-->
                    <th>Abflug</th>
                    <th>Ankunft</th>
                    <th>Preis (ab)</th>
                    <th>Auslastung</th>
                    <th>Buchen</th>
                </tr>
                <!--
                <tr>
                    <td>45121151</td>
                    <td>Brüssel</td>
                    <td>Berlin</td>
                    <td>08.05.2018</td>
                    <td>04:00</td>
                    <td>06:00</td>
                    <td>50€</td>
                    <td>120/250</td>
                    <td><a href="booking.html">buchen</a></td>
                </tr>
                <tr>
                    <td>12124512</td>
                    <td>Brüssel</td>
                    <td>Madrid</td>
                    <td>08.05.2018</td>
                    <td>06:00</td>
                    <td>08:00</td>
                    <td>150€</td>
                    <td>20/250</td>
                    <td><a href="booking.html">buchen</a></td>
                </tr>
                <tr>
                    <td>315125125</td>
                    <td>Brüssel</td>
                    <td>London</td>
                    <td>08.05.2018</td>
                    <td>08:00</td>
                    <td>10:00</td>
                    <td>110€</td>
                    <td>123/250</td>
                    <td><a href="booking.html">buchen</a></td>
                </tr>
                <tr>
                    <td>46636733</td>
                    <td>Brüssel</td>
                    <td>Wien</td>
                    <td>08.05.2018</td>
                    <td>10:00</td>
                    <td>12:00</td>
                    <td>110€</td>
                    <td>200/250</td>
                    <td><a href="booking.html">buchen</a></td>
                </tr>
                <tr>
                    <td>9935285235</td>
                    <td>Brüssel</td>
                    <td>Rom</td>
                    <td>08.05.2018</td>
                    <td>12:00</td>
                    <td>14:00</td>
                    <td>140€</td>
                    <td>3/250</td>
                    <td><a href="booking.html">buchen</a></td>
                </tr>
                -->
            </table>
        </div>
    </div>


    <footer>
		<div>
			<ul class="foot">
			    <li class="footli"><p class="lastline"><a class="lastline" href="https://europa.eu/youreurope/citizens/travel/passenger-rights/air/index_de.htm">Passagierrechte</a></p></li>
			    <li class="footli"><p class="lastline"><a class="lastline" href="impressum.html">Impressum</a></li>
                <li><a class="lastline" href="agb.html">AGB</a></li>
            </ul>
		</div>
	</footer>
</body>


<!--wie in home nur mit loadFlight()-->
<script type="text/javascript">

    window.onload = function loadContent() {
       console.log('Dokument geladen');

       loadFlight();                       
   }



/* bis for wie in  loadFlightInfo(), + price und capacity, statt eines Links wie im Prototypen wird ein Button mit generiert, der beim Betätigen die Funktion genBooking aufruft mit dem angeforderten JSON-Objekt und der ausgewählten Flugid als Übergabeparameter
    andere Lösungsansätze: -das JSON-Objekt global verfügbar machen um nur das i zu übergeben (sehr unelegant!!!)
                           -nur die FlugId übergeben und in genBooking() nochmals die Daten zu der FlugID beim Server nachfragen
*/
   function loadFlight() {
      var xhttp = new XMLHttpRequest();
       xhttp.onreadystatechange = function () {
           if(this.readState == 4 && this.status == 200) {
               var jsn = JSON.parse(this.responseText);

               for(var i = 0; i < jsn.flight.length; i++) {
                   document.getElementById("flights").innerHTML += 
                       "<tr><td>" + jsn.flight[i].flightnr + "</td>" +
                           "<td>" + jsn.flight[i].fromcountry + "</td>" +
                           "<td>" + jsn.flight[i].tocountry + "</td>" +
                           "<td>" + jsn.flight[i].takeoff + "</td>" +
                           "<td>" + jsn.flight[i].arrival + "</td></tr>" +
                           "<td>" + jsn.flight[i].price + "</td></tr>" +
                           "<td>" + jsn.flight[i].capacity + "/250</td></tr>" +
                           "<td><button id=\"kackbutton\" class=\"inputs suinput\" onclick=\"genBooking(" + jsn + ", " + jsn.flight[i].id")\" name=\"selfli\" value=\"" + jsn.flight[i].id + "\">Buchen</button></td></tr>";
               }
           }
       }
       xhttp.open("GET", "http://localhost:8080/NerdAirways/flight", true);
       xhttp.send();
   }


   /* test für ohne DB, geht nicht irgendwo evtl. ein Fehler im JSON... 
   function loadFlight(){
   var responseText = "{\"flight\":[{\"id\":1000,\"flightnr\":5000,\"fromid\":1,\"toid\":2,\"takeoff\":4,\"arrival\":6,\"price\":50,\"fromcountry\":\"Brüssel\",\"tocountry\":\"Berlin\",\"capacity\":120}," +
                           "{\"id\":1001,\"flightnr\":6000,\"fromid\":1,\"toid\":3,\"takeoff\":6,\"arrival\":8,\"price\":80,\"fromcountry\":\"Brüssel\",\"tocountry\":\"Madrid\",\"capacity\":20}," +
                           "{\"id\":1002,\"flightnr\":7000,\"fromid\":1,\"toid\":4,\"takeoff\":8,\"arrival\":10,\"price\":60,\"fromcountry\":\"Brüssel\",\"tocountry\":\"London\",\"capacity\":123}" +
                       "]}";

   var jsn = JSON.parse(this.responseText);

   for(var i = 0; i < jsn.flight.length; i++) {
                   document.getElementById("flights").innerHTML += 
                       "<tr><td>" + jsn.fligh[i].flightnr + "</td>" +
                           "<td>" + jsn.flight[i].fromcountry + "</td>" +
                           "<td>" + jsn.flight[i].tocountry + "</td>" +
                           "<td>" + jsn.flight[i].takeoff + "</td>" +
                           "<td>" + jsn.flight[i].arrival + "</td></tr>" +
                           "<td>" + jsn.flight[i].price + "</td></tr>" +
                           "<td>" + jsn.flight[i].capacity + "/250</td></tr>" +
                           "<td><td><button id=\"bookbut\" class=\"inputs\" onclick=\"genBooking(" + jsn  + ")\" name=\"selfli\" value=\"" + flight[i].id + "\">Buchen</button></td></tr>";
               }
   }
   */





/* alternative Lösungsansätze siehe oben */
/* die Funktion genBooking bekommt in dieser Lösungsvariante das beim ersten Laden angeforderte JSON-Objekt mit den verfügbaren Flügen und der ausgewählten FlugID übergeben
das zentrale div (center bzw. central) wird neu generiert, dabei werden die Flugdaten des ausgwählten Fluges noch einmal dargestellt
zusätzlich erscheinen die Eingabefelder aus der urspünglichen booking.html
durch das Attribut onchange wird bei jeder Änderung der angezeigte Preis entsprechend verändert, durch Aufrufen von prcCalc()
nach betätigen des Buttons Buchen sind die für aw_booking benötigten Daten an den Server zu senden: - selFliId für FLIGID
                                                                                                    - falls CookieSession aktiv: CUSTID
                                                                                                    - clss.value als CLASID
                                                                                                    - lugg.value als LAGGID
                                                                                                    - price.innerHTML als price
je nach Umsetzung:  - bei clss und lugg den value als CLASID bzw. LAGGID
                    - bei kein price senden sondern serverseitig berechnen für mehr Sicherheit

*/                
   function genBooking(jsn, selFliId){
    document.getElementById("center").innerHTML = 
    "<div class=\"flightinfo\"><h2>Fluginformationen für Flug "+ jsn.fligh[selFliId].flightnr +"</h2><table><tr><td>Flugnummer:</td><td>" + jsn.flight[selFliId].flightnr + "</td></tr><tr><td>Von:</td><td>" + jsn.flight[selFliId].fromcountry + "</td></tr><tr><td>Nach:</td><td>" + jsn.flight[selFliId].tocountry + "</td></tr><tr></tr><tr><td>Abflug:</td><td>" + jsn.flight[selFliId].takeoff + "</td></tr><tr><td>Ankunft:</td><td>" + jsn.fligh[selFliId].arrival + "</td></tr><tr><td>Basispreis:</td><td id=\"bscprc\">" + jsn.flight[selFliId].price + "</td></tr></table><hr></div>" + 
		"<div class=\"bookingbottom\"><h2>Leistungen</h2><table><tr><td><label>Klasse</label><br><select id=\"clss\" class=\"inputs suinput\" name=\"class\" onchange=\"prcCalc()\"><option value=\"0\">Economy</option><option value=\"110\">Business +110€</option><option value=\"770\">First Class +770€</option></select></td><td><label>Zusatzgepäck</label><br><select id=\"lugg\" class=\"inputs suinput\" name=\"lugg\" onchange=\"prcCalc()\"><option value=\"0\">-----</opton><option value=\"30\">15kg +30€</option><option value=\"60\">30kg +60€</option><option value=\"90\">45kg +90€</option></select></td></tr>" +
        "<tr><td><!--<label>Preis (inkl. MwSt)</label><br>--><label id=\"priceframe\">Gesamtpreis (inkl. MwSt): <span id=\"price\">110</span>€</label></td>" +	
				"<td><label>Ich habe die <a class=\"lastline\" href=\"agb.html\" target=\"_blank\">AGB</a> gelesen.</label><input type=\"checkbox\" name=\"agb\" value=\"AGB\" required><a id=\"kackbutton\" href=\"booking_confirm.1.html\">Buchen</a></td></tr>	</table></div>"
    ;
} 



/* die Funktion prcCalc wird ausgelöst wenn bei den selects clss und lugg etwas geändert wird
es wird entsprechend aktuelle Werte der beiden selects als Number mit dem Preis aufsummiert und im span price angezeigt
*/
function prcCalc(){
	var x = Number(document.getElementById("clss").value) + Number(document.getElementById("lugg").value) + Number(document.getElementById("bscprc").innerHTML;
  alert(x);
    document.getElementById("price").innerHTML = x;
}

</script>


</html>
